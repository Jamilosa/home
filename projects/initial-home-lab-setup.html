<!DOCTYPE html> <html><head>
		<title>Initial Home Lab Setup</title>
		<base href="../">
		<meta id="root-path" root-path="../">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0">
		<meta charset="UTF-8">
		<meta name="description" content="CS Vault     - Initial Home Lab Setup">
		<meta property="og:title" content="Initial Home Lab Setup">
		<meta property="og:description" content="CS Vault     - Initial Home Lab Setup">
		<meta property="og:type" content="website">
		<meta property="og:url" content="https://jamilosa.github.io/home/projects/initial-home-lab-setup.html">
		<meta property="og:image" content="https://jamilosa.github.io/home/lib/media/initial-home-lab-configuration1.png">
		<meta property="og:site_name" content="CS Vault    ">
		<meta name="author" content="ryan-jamilosa"><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://jamilosa.github.io/home/lib/rss.xml"><script async="" id="webpage-script" src="lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="minisearch-script" src="https://cdn.jsdelivr.net/npm/minisearch@6.3.0/dist/umd/index.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="lib/media/favicon.png"><include src="lib/html/custom-head-content.html"></include><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-horizontal-spacing:0.6em;--tree-vertical-spacing:0.6em;--sidebar-margin:12px}.sidebar{height:100%;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));font-size:14px;z-index:10;position:relative;overflow:hidden;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}.sidebar-left{left:0}.sidebar-right{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}body.floating-sidebars .sidebar{position:absolute}.sidebar-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .sidebar-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}.sidebar-left .sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}.sidebar-right .sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar:has(.sidebar-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:2em;width:var(--sidebar-width);top:var(--sidebar-margin);padding-inline:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}.sidebar-left .sidebar-topbar{left:0}.sidebar-right .sidebar-topbar{right:0}.topbar-content{overflow:hidden;overflow:clip;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:0!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}.sidebar-left .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}.sidebar-right .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.sidebar-section-header{margin:0 0 1em 0;text-transform:uppercase;letter-spacing:.06em;font-weight:600}body{transition:background-color var(--color-fade-speed) ease-in-out}.webpage-container{display:flex;flex-direction:row;height:100%;width:100%;align-items:stretch;justify-content:center}.document-container{opacity:1;flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0;transition:opacity .2s ease-in-out}.document-container>.markdown-preview-view{margin:var(--sidebar-margin);margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;background-color:var(--background-primary);transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}.document-container>.markdown-preview-view>.markdown-preview-sizer{padding-bottom:80vh!important;width:100%!important;max-width:var(--line-width)!important;flex-basis:var(--line-width)!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}.markdown-rendered img:not([width]),.view-content img:not([width]){max-width:100%;outline:0}.document-container>.view-content.embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}.document-container>.view-content.embed>*{max-width:100%;max-height:100%;object-fit:contain}:has(> :is(.math,table)){overflow-x:auto!important}.document-container>.view-content{overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){if("file:"!=location.protocol){let e=document.querySelectorAll("include");for(let t=0;t<e.length;t++){let o=e[t],l=o.getAttribute("src");try{const e=await fetch(l);if(!e.ok){console.log("Could not include file: "+l),o?.remove();continue}let t=await e.text(),n=document.createRange().createContextualFragment(t),i=Array.from(n.children);for(let e of i)e.classList.add("hide"),e.style.transition="opacity 0.5s ease-in-out",setTimeout((()=>{e.classList.remove("hide")}),10);o.before(n),o.remove(),console.log("Included file: "+l)}catch(e){o?.remove(),console.log("Could not include file: "+l,e);continue}}}else{if(document.querySelectorAll("include").length>0){var e=document.createElement("div");e.id="error",e.textContent="Web server exports must be hosted on an http / web server to be viewed correctly.",e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.fontSize="1.5em",e.style.fontWeight="bold",e.style.textAlign="center",document.body.appendChild(e),document.querySelector(".document-container")?.classList.remove("hide")}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script"))),l=0;!function e(){let n=o[l];l++,n&&"true"!=n.getAttribute("loaded")||l<o.length&&e(),l<o.length?n.addEventListener("load",e):t()}()}</script><link rel="stylesheet" href="lib/styles/obsidian.css"><link rel="stylesheet" href="lib/styles/theme.css"><link rel="preload" href="lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/main-styles.css"></noscript></head><body class="publish css-settings-manager theme-dark show-inline-title show-ribbon"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="webpage-container workspace"><div class="sidebar-left sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme_toggle"><input class="theme-toggle-input" type="checkbox" id="theme_toggle"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="search-input-container"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div class="search-input-clear-button" aria-label="Clear search"></div></div><include src="lib/html/file-tree.html"></include></div><script defer="">let ls = document.querySelector(".sidebar-left"); ls.classList.add("is-collapsed"); if (window.innerWidth > 768) ls.classList.remove("is-collapsed"); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div><div class="document-container markdown-reading-view hide"><div class="markdown-preview-view markdown-rendered allow-fold-headings allow-fold-lists is-readable-line-width"><style id="MJX-CHTML-styles"></style><div class="markdown-preview-sizer markdown-preview-section"><h1 class="page-title heading inline-title" id="Initial Home Lab Setup">Initial Home Lab Setup</h1><div class="el-p"><p dir="auto">Date: Feb 06, 2025<br>
Tags: <a data-href="network defense" href="-tags/network-defense.html" class="internal-link" target="_self" rel="noopener nofollow">network defense</a> <a data-href="Active Directory" href="-tags/active-directory.html" class="internal-link" target="_self" rel="noopener nofollow">Active Directory</a>  <a data-href="Wazuh" href="-tags/wazuh.html" class="internal-link" target="_self" rel="noopener nofollow">Wazuh</a> <a data-href="SIEM" href="-tags/siem.html" class="internal-link" target="_self" rel="noopener nofollow">SIEM</a> <a data-href="iptables" href="-tags/iptables.html" class="internal-link" target="_self" rel="noopener nofollow">iptables</a> <a data-href="tcpdump" href="-tags/tcpdump.html" class="internal-link" target="_self" rel="noopener nofollow">tcpdump</a> <a data-href="firewall" href="-tags/firewall.html" class="internal-link" target="_self" rel="noopener nofollow">firewall</a> <a data-href="port forwarding" href="-tags/port-forwarding.html" class="internal-link" target="_self" rel="noopener nofollow">port forwarding</a> <a data-href="log" href="-tags/log.html" class="internal-link" target="_self" rel="noopener nofollow">log</a></p></div><div class="el-h1 heading-wrapper"><div class="heading-children"><div class="el-h2 heading-wrapper"><h2 data-heading="I. Introduction" dir="auto" class="heading" id="I._Introduction"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>I. Introduction</h2><div class="heading-children"><div class="el-h3 heading-wrapper"><h3 data-heading="1.1 Context &amp; Purpose" dir="auto" class="heading" id="1.1_Context_&amp;_Purpose"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1.1 Context &amp; Purpose</h3><div class="heading-children"><div class="el-p"><p dir="auto">Setting up a home lab provides a controlled environment to simulate cyber attacks, test defenses, and develop mitigation strategies. It enhances hands-on cybersecurity skills, making it a powerful tool for learning and experimentation.</p></div><div class="el-p"><p dir="auto">In this entry, I'm refining my home lab setup, focusing on Wazuh as a SIEM that collects security events from a firewall and multiple endpoint devices.</p></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="1.2 What This Covers" dir="auto" class="heading" id="1.2_What_This_Covers"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1.2 What This Covers</h3><div class="heading-children"><div class="el-ul"><ul>
<li data-line="0" dir="auto">Deploying <strong>Wazuh on Docker</strong> by following official documentation </li>
<li data-line="1" dir="auto">Setting up <strong>Active Directory (Windows Server 2022)</strong></li>
<li data-line="2" dir="auto">Configuring <strong>AntiX as a firewall</strong> (iptables, NAT, port forwarding, logging)</li>
<li data-line="3" dir="auto">Setting up a <strong>router for internal networking</strong></li>
</ul></div></div></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="II. Setup &amp; Environment" dir="auto" class="heading" id="II._Setup_&amp;_Environment"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>II. Setup &amp; Environment</h2><div class="heading-children"><div class="el-h3 heading-wrapper"><h3 data-heading="2.1 Network Overview" dir="auto" class="heading" id="2.1_Network_Overview"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.1 Network Overview</h3><div class="heading-children"><div class="el-p"><p dir="auto"><span alt="Initial Home Lab Configuration1.png" src="Initial Home Lab Configuration1.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Initial Home Lab Configuration1.png" src="lib/media/initial-home-lab-configuration1.png"></span><br>
Figure 1: Network diagram of the internal and external network for the home lab.</p></div><div class="el-table" dir="ltr" style="overflow-x: auto;"><table>
<thead>
<tr>
<th dir="ltr">OS</th>
<th dir="ltr">Application / Services</th>
</tr>
</thead>
<tbody>
<tr>
<td dir="ltr">AntiX</td>
<td dir="ltr">Iptables, rsyslog</td>
</tr>
<tr>
<td dir="ltr">Ubuntu 24.01</td>
<td dir="ltr">Wazuh server</td>
</tr>
<tr>
<td dir="ltr">Windows Server 2022</td>
<td dir="ltr">Domain Controller, Wazuh agent</td>
</tr>
<tr>
<td dir="ltr">Windows 10 Pro</td>
<td dir="ltr">Domain member, Wazuh agent</td>
</tr>
<tr>
<td dir="ltr">Linux Mint 22</td>
<td dir="ltr">Wazuh agent</td>
</tr>
</tbody>
</table></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="2.2 Prerequisites" dir="auto" class="heading" id="2.2_Prerequisites"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.2 Prerequisites</h3><div class="heading-children"><div class="el-ul"><ul>
<li data-line="0" dir="auto">Operating systems listed on previous section.</li>
<li data-line="1" dir="auto">At least two network interfaces on AntiX host.</li>
<li data-line="2" dir="auto">SSH server running on Ubuntu and AntiX (optional).</li>
</ul></div></div></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="III. Execution &amp; Findings" dir="auto" class="heading" id="III._Execution_&amp;_Findings"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>III. Execution &amp; Findings</h2><div class="heading-children"><div class="el-h3 heading-wrapper"><h3 data-heading="3.1 Wazuh on Docker (Ubuntu)" dir="auto" class="heading" id="3.1_Wazuh_on_Docker_(Ubuntu)"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.1 Wazuh on Docker (Ubuntu)</h3><div class="heading-children"><div class="el-h5 heading-wrapper"><h5 data-heading="3.1.1 Wazuh Server" dir="auto" class="heading" id="3.1.1_Wazuh_Server"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.1.1 Wazuh Server</h5><div class="heading-children"><div class="el-p"><p dir="auto">Deploying Wazuh on docker is quick, simple, and requires only a few steps:</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">Increase <code>vm.max_map_count</code> to support the Wazuh Indexer</li>
<li data-line="1" dir="auto">Install Docker and Docker Compose</li>
<li data-line="2" dir="auto">Clone the official Wazuh container repository</li>
<li data-line="3" dir="auto">Generate a self-signed certificate for secure communication</li>
<li data-line="4" dir="auto">Run <code>docker-compose up</code> to start the deployment</li>
</ol></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="3.1.2 Wazuh Agent" dir="auto" class="heading" id="3.1.2_Wazuh_Agent"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.1.2 Wazuh Agent</h5><div class="heading-children"><div class="el-p"><p dir="auto">Wazuh manager monitors endpoints through the Wazuh agents installed on target hosts. Deployment steps for Windows/Linux agents:</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">Access the Wazuh web interface at <code>https://&lt;server.ip.address&gt;</code></li>
<li data-line="1" dir="auto">Navigate to Menu &gt; Server Management &gt; Endpoint Summary &gt; Deploy New Agent</li>
<li data-line="2" dir="auto">Select the target operating system</li>
<li data-line="3" dir="auto">Specify server IP address</li>
<li data-line="4" dir="auto">Assign an agent name and group (optional)</li>
<li data-line="5" dir="auto">Execute provided command to download and install agent</li>
<li data-line="6" dir="auto">Start the Wazuh agent or enable auto-start.</li>
</ul></div><div class="el-p"><p dir="auto">While the setup itself is straightforward, I wanted to go beyond simply running the Wazuh container so I studied Wazuh's architecture to better understand how components interact with each other. For a closer look on Wazuh's architecture, see my notes on <a data-href="Wazuh Architecture" href="Wazuh Architecture" class="internal-link" target="_self" rel="noopener nofollow">Wazuh Architecture</a>.</p></div></div></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="3.2 Active Directory Domain (Windows Server 2022)" dir="auto" class="heading" id="3.2_Active_Directory_Domain_(Windows_Server_2022)"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.2 Active Directory Domain (Windows Server 2022)</h3><div class="heading-children"><div class="el-p"><p dir="auto">Setup up Active Directory on Windows Server 2022 by following the standard procedures with minor changes on the configurations:</p></div><div class="el-table" dir="ltr" style="overflow-x: auto;"><table>
<thead>
<tr>
<th dir="ltr">Configuration</th>
<th dir="ltr">Value</th>
<th dir="ltr">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td dir="ltr">Domain Name</td>
<td dir="ltr"><code>eventura.lab</code></td>
<td dir="ltr">Internal lab domain</td>
</tr>
<tr>
<td dir="ltr">Domain Controller IP</td>
<td dir="auto"><code>10.0.0.1</code></td>
<td dir="ltr">Assigned to the DC for consistency and network resolution.</td>
</tr>
<tr>
<td dir="ltr">Gateway</td>
<td dir="auto"><code>10.0.0.254</code></td>
<td dir="ltr">Handles traffic routing outside the lab network.</td>
</tr>
<tr>
<td dir="ltr">DNS Server</td>
<td dir="auto"><code>10.0.0.1</code></td>
<td dir="ltr">DC functions as the DNS server for the lab network.</td>
</tr>
</tbody>
</table></div><div class="el-p"><p dir="auto">I also added OUs, users, and groups for policy and permission management (see Figure 2).<br>
<span alt="Initial Home Lab Configuration2.png" src="Initial Home Lab Configuration2.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Initial Home Lab Configuration2.png" src="lib/media/initial-home-lab-configuration2.png"></span><br>
Figure 2: Initial Active Directory domain hierarchy for <code>eventura.lab</code>.</p></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="3.3 Iptables Firewall (AntiX)" dir="auto" class="heading" id="3.3_Iptables_Firewall_(AntiX)"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.3 Iptables Firewall (AntiX)</h3><div class="heading-children"><div class="el-h5 heading-wrapper"><h5 data-heading="3.3.1 Renaming Network Interfaces" dir="auto" class="heading" id="3.3.1_Renaming_Network_Interfaces"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.3.1 Renaming Network Interfaces</h5><div class="heading-children"><div class="el-p"><p dir="auto"> Assigning intuitive interface names increases the readability of the configurations and ease troubleshooting in the future.</p></div><div class="el-table" dir="ltr" style="overflow-x: auto;"><table>
<thead>
<tr>
<th dir="ltr">MAC Address</th>
<th dir="ltr">Interface Name</th>
<th dir="ltr">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td dir="ltr"><code>00:03:0d:53:17:49</code></td>
<td dir="ltr"><code>wan0</code></td>
<td dir="ltr">Connected to external network (edge router and the internet).</td>
</tr>
<tr>
<td dir="ltr"><code>00:e0:4c:36:06:d7</code></td>
<td dir="ltr"><code>lan0</code></td>
<td dir="ltr">Connected to internal network (lab router, ubuntu server, windows server, and other lab users)</td>
</tr>
</tbody>
</table></div><div class="el-p"><p dir="auto">I updated the <code>NAME</code> value of a row that corresponds to the network interface card's MAC address in <code>/etc/udev/rules.d/70-persistent-net.rules</code> (see Figure 3) and applied the changes using the following commands:</p></div><div class="el-pre"><pre><code data-line="0">sudo udevadm control --reload-rules
sudo udevadm trigger
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Initial Home Lab Configuration3.png" src="Initial Home Lab Configuration3.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Initial Home Lab Configuration3.png" src="lib/media/initial-home-lab-configuration3.png"></span><br>
Figure 3: Editing <code>/etc/udev/rules.d/70-persistent-net.rules</code> to rename network interfaces.</p></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="3.3.2 Assigning Static Route and IP Address" dir="auto" class="heading" id="3.3.2_Assigning_Static_Route_and_IP_Address"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.3.2 Assigning Static Route and IP Address</h5><div class="heading-children"><div class="el-p"><p dir="auto">For consistency, I assigned static IP addresses to both <code>wan0</code> and <code>lan0</code> interface in <code>/etc/network/interfaces</code>. The last line creates a static route to the lab network <code>10.0.0.0/24</code> via the lab router <code>10.0.1.2</code> that is connected on <code>lan0</code> interface:</p></div><div class="el-pre"><pre><code data-line="0">auto wan0
iface wan0 inet static
    address 192.168.1.250
    netmask 255.255.255.0
    gateway 192.168.1.1

auto lan0
iface lan0 inet static
    address 10.0.1.1
    netmask 255.255.255.0

up ip route add 10.0.0.0/24 via 10.0.1.2 dev lan0
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Restart the <code>networking</code> service to apply the changes:</p></div><div class="el-pre"><pre><code data-line="0">sudo service networking restart
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">I ran <code>ip a</code> to verify the changes before continuing with the next steps (see Figure 4).<br>
<span alt="Initial Home Lab Configuration4.png" src="Initial Home Lab Configuration4.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Initial Home Lab Configuration4.png" src="lib/media/initial-home-lab-configuration4.png"></span><br>
Figure 4: Output of <code>ip a</code> verifying static IP assignment interface renaming.</p></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="3.3.3 IP Forwarding" dir="auto" class="heading" id="3.3.3_IP_Forwarding"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.3.3 IP Forwarding</h5><div class="heading-children"><div class="el-p"><p dir="auto"><strong>IP forwarding</strong>, more commonly known as <strong>routing</strong> is a feature of Linux kernel that is disabled by default. I enabled the IP forwarding on <code>/etc/sysctl.conf</code> (see Figure 5) and applied the changes with:</p></div><div class="el-pre"><pre><code data-line="0">sudo sysctl -p
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">I then used <code>iptables</code> to control the traffic passing through the firewall.</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">Default: Drop all forwarded packets unless explicitly allowed.</li>
<li data-line="1" dir="auto">Outgoing Traffic: Allow packets from <code>lan0</code> -&gt; <code>wan0</code>.</li>
<li data-line="2" dir="auto">Incoming Traffic: Allow only related/established connection from <code>wan0</code> -&gt; <strong>lan0</strong>.</li>
</ul></div><div class="el-pre"><pre><code data-line="0">sudo iptables -P FORWARD DROP
sudo iptables -A FORWARD -i lan0 -o wan0 -j ACCEPT
sudo iptables -A FORWARD -i wan0 -o lan0 -m state --state RELATED,ESTABLISHED -j ACCEPT
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">See Figure 6-8 for the packet flow.</p></div><div class="el-p"><p dir="auto"><span alt="Initial Home Lab Configuration5.png" src="Initial Home Lab Configuration5.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Initial Home Lab Configuration5.png" src="lib/media/initial-home-lab-configuration5.png"></span><br>
Figure 5: Enabling IP forwarding in&nbsp;<code>/etc/sysctl.conf</code>&nbsp;(uncommenting&nbsp;<code>net.ipv4.ip_forward=1</code>).</p></div><div class="el-p"><p dir="auto"><span alt="accept-in-lan0-out-wan0.png" src="accept-in-lan0-out-wan0.png" class="internal-embed media-embed image-embed is-loaded"><img alt="accept-in-lan0-out-wan0.png" src="lib/media/accept-in-lan0-out-wan0.png"></span><br>
Figure 6: All traffic from lab router destined to the external network are allowed.</p></div><div class="el-p"><p dir="auto"><span alt="accept-incoming-wan0-outgoing-lan0-established.png" src="accept-incoming-wan0-outgoing-lan0-established.png" class="internal-embed media-embed image-embed is-loaded"><img alt="accept-incoming-wan0-outgoing-lan0-established.png" src="lib/media/accept-incoming-wan0-outgoing-lan0-established.png"></span><br>
Figure 7: Packet (5) coming in <code>wan0</code> interface and going out of <code>lan0</code> interface is allowed because it was a response to a packet (1) that originated within the <code>lan0</code> interface.</p></div><div class="el-p"><p dir="auto"><span alt="drop-forward-default.png" src="drop-forward-default.png" class="internal-embed media-embed image-embed is-loaded"><img alt="drop-forward-default.png" src="lib/media/drop-forward-default.png"></span><br>
Figure 8: Packet that does not match any rule on the <code>FORWARD</code> chain are <strong>dropped</strong> by default.</p></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="3.3.4 Configuring NAT with iptables" dir="auto" class="heading" id="3.3.4_Configuring_NAT_with_iptables"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.3.4 Configuring NAT with iptables</h5><div class="heading-children"><div class="el-pre"><pre><code data-line="0">NAT (Masquerade) was configured to turn the real source IP address of outbound traffic into the firewall's own IP address (see Figure 9). This simplifies the routing when internal network's subnet is changed. 
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-pre"><pre><code data-line="0">sudo iptables -t nat -A POSTROUTING -o wan0 -j MASQUERADE
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20250213073703.png" src="Pasted image 20250213073703.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250213073703.png" src="lib/media/pasted-image-20250213073703.png"></span><br>
Figure 9: AntiX firewall translates the packet <strong>source</strong> IP address (1) into its own <code>wan0</code> IP address (3) before passing it to the next router; <strong>SNAT</strong>. It also reverse the process for return traffic by changing the destination (4) to the real <strong>destination</strong> (6) IP address; <strong>DNAT</strong>. </p></div><div class="el-p"><p dir="auto">I saved the changes in the iptables using <code>iptables-persistent</code> with:</p></div><div class="el-pre"><pre><code data-line="0">sudo apt update &amp;&amp; sudo apt install iptables-persistent -y
sudo iptables-save | sudo tee /etc/iptables/rules.v4   
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="3.3.5 SSH Port Forwarding" dir="auto" class="heading" id="3.3.5_SSH_Port_Forwarding"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.3.5 SSH Port Forwarding</h5><div class="heading-children"><div class="el-p"><p dir="auto">To access to the Ubuntu Server's SSH service over the external network, I enabled port forwarding on the AntiX firewall using the iptables (see Figure 10). Since AntiX firewall is already running SSH service on port 22, I set the firewall to listen on port 2222 (<code>192.168.1.250:2222</code>), perform DNAT and send the traffic to port 22 of the Ubuntu Server (<code>10.0.0.2:22</code>). Figure 11 shows the packet got DNATed and SNATed as it pass through the firewall. The response on Figure 12  confirms that SSH traffic from external host was successfully forwarded to the internal host.</p></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20250210212156.png" src="Pasted image 20250210212156.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250210212156.png" src="lib/media/pasted-image-20250210212156.png"></span><br>
Figure 10: Iptables Destination NAT rule forwards external SSH traffic (port 2222) to Ubuntu Server (port 22).</p></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20250210222828.png" src="Pasted image 20250210222828.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250210222828.png" src="lib/media/pasted-image-20250210222828.png"></span><br>
Figure 11: Traffic flow diagram for SSH port forwarding through the firewall.</p></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20250210231057.png" src="Pasted image 20250210231057.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250210231057.png" src="lib/media/pasted-image-20250210231057.png"></span><br>
Figure 12: Right: Firewall's <code>wan0</code> interface received a packet from an external host (<code>192.168.1.233:44966</code>) destined to port <code>2222</code>, <code>seq 2383482268</code> indicates the start of SSH handshake.<br>
Left: Firewall's <code>lan0</code> interface received an SSH packet from Ubuntu Server (<code>10.0.0.2:22</code>) destined to the external host (<code>192.168.1.233:44966</code>), <code>ack 2383482269</code> (seq+1) indicates that it was a response to the SSH handshake from the external host.</p></div></div></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="3.4 Lab Network Configuration" dir="auto" class="heading" id="3.4_Lab_Network_Configuration"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.4 Lab Network Configuration</h3><div class="heading-children"><div class="el-h5 heading-wrapper"><h5 data-heading="3.4.1 Router WAN Configuration" dir="auto" class="heading" id="3.4.1_Router_WAN_Configuration"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.4.1 Router WAN Configuration</h5><div class="heading-children"><div class="el-p"><p dir="auto">To make this setup work. I configured the router's WAN IP address to the same network as the firewall's <code>lan0</code> interface. Additionally, I set the router's default gateway to the firewall's <code>lan0</code> IP address to ensure that external traffic get routed to the firewall (see Figure 13). Since AntiX firewall is already performing NAT, I disabled it on the router (see Figure 14).<br>
<span alt="Pasted image 20250208204338.png" src="Pasted image 20250208204338.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250208204338.png" src="lib/media/pasted-image-20250208204338.png"></span><br>
Figure 13: Router WAN configuration matching the firewall’s LAN subnet (10.0.1.0/24).</p></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20250210203253.png" src="Pasted image 20250210203253.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250210203253.png" src="lib/media/pasted-image-20250210203253.png"></span><br>
Figure 14: NAT was disabled on WAN interface.</p></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="3.4.2 Router LAN Configuration" dir="auto" class="heading" id="3.4.2_Router_LAN_Configuration"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.4.2 Router LAN Configuration</h5><div class="heading-children"><div class="el-p"><p dir="auto">I assigned <code>10.0.0.254</code> as the lab router's LAN IP address and subnet mask to <code>255.255.255.0</code>. (see Figure 15). This establishes that the router belongs to the subnet 10.0.0.0/24. I also configured the DHCP server for new hosts to send packet going to the external network to be routed on the lab router. Hosts will also use the Domain Controller as their primary DNS server (see Figure 16).</p></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20250208205022.png" src="Pasted image 20250208205022.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250208205022.png" src="lib/media/pasted-image-20250208205022.png"></span><br>
Figure 15: The LAN IP address was set to <code>10.0.0.254/24</code> which also set the local subnet to 10.0.0.0/24.</p></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20250208205727.png" src="Pasted image 20250208205727.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250208205727.png" src="lib/media/pasted-image-20250208205727.png"></span><br>
Figure 16: The router set its own IP address as default gateway and the DC as the primary DNS server.</p></div></div></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="3.5 Filtering Traffic" dir="auto" class="heading" id="3.5_Filtering_Traffic"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.5 Filtering Traffic</h3><div class="heading-children"><div class="el-h5 heading-wrapper"><h5 data-heading="3.5.1 Logging and Blocking on iptables" dir="auto" class="heading" id="3.5.1_Logging_and_Blocking_on_iptables"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.5.1 Logging and Blocking on iptables</h5><div class="heading-children"><div class="el-p"><p dir="auto">While blocking unwanted traffic might seem enough. It might be important to log contextual information such as the time when the traffic was blocked, who sent the traffic, and where it is destined to go. Figure 17 shows an iptables rules that log a packet from <code>lan0</code> to <code>wan0</code> that is using <code>tcp</code> port <code>80</code> before dropping that same packet.<br>
<span alt="Pasted image 20250211145608.png" src="Pasted image 20250211145608.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250211145608.png" src="lib/media/pasted-image-20250211145608.png"></span><br>
Figure 17: Iptables rules logging and blocking HTTP traffic on <code>wan0</code> interface.</p></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="3.5.2 Dedicating a Log File for Iptables" dir="auto" class="heading" id="3.5.2_Dedicating_a_Log_File_for_Iptables"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.5.2 Dedicating a Log File for Iptables</h5><div class="heading-children"><div class="el-p"><p dir="auto">Iptables log are stored to the <code>/var/log/kern.log</code> by default which includes all other logs related to the kernel. I installed <code>rsyslog</code> and edited its configuration on <code>/etc/rysyslog.conf</code> to assign kernel logs that has both 'IN=' and 'OUT=' to be stored on <code>/var/log/iptables.log</code> (see Figure 18). Then I restarted rsyslog service to apply the changes with the following command:</p></div><div class="el-pre"><pre><code data-line="0">sudo service rsyslog restart
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20250211143840.png" src="Pasted image 20250211143840.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250211143840.png" src="lib/media/pasted-image-20250211143840.png"></span><br>
Figure 18: Rsyslog configuration filtering iptables logs to&nbsp;<code>/var/log/iptables.log</code>.</p></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="3.5.3 Testing Firewall Rules" dir="auto" class="heading" id="3.5.3_Testing_Firewall_Rules"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.5.3 Testing Firewall Rules</h5><div class="heading-children"><div class="el-p"><p dir="auto">Before I applied the rules on Figure 17, I tested the command <code>curl</code> to access an HTTP-only site <code>http://httpforever.com/</code> from the Ubuntu Server. Figure 19 shows the http response from the site.<br>
<span alt="Pasted image 20250211134315.png" src="Pasted image 20250211134315.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250211134315.png" src="lib/media/pasted-image-20250211134315.png"></span><br>
Figure 19: Curl test confirms HTTP access before firewall rule implementation.</p></div><div class="el-p"><p dir="auto">After the rules on Figure 17 was applied using the command below. HTTP traffic from <code>lan0</code> to <code>wan0</code> has been successfully logged and blocked (see Figure 20).</p></div><div class="el-pre"><pre><code data-line="0">sudo iptables-restore &lt; /etc/iptables/rules.v4
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20250211151501.png" src="Pasted image 20250211151501.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250211151501.png" src="lib/media/pasted-image-20250211151501.png"></span><br>
Figure 20: Blocked HTTP traffic logged in&nbsp;<code>/var/log/iptables.log</code>.</p></div></div></div></div></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="IV. Observations" dir="auto" class="heading" id="IV._Observations"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>IV. Observations</h2><div class="heading-children"><div class="el-ul"><ul>
<li data-line="0" dir="auto">Although Wazuh deployment was straightforward, the default configuration generates large volume of events, indicating the need for further fine-tuning.</li>
<li data-line="1" dir="auto">The heavy reliance on DNS of AD Domain was unexpected but it highlights the crucial role DNS plays in authentication and network management.    </li>
<li data-line="2" dir="auto">The centralized resource management and user permission control offered by AD can significantly increase an organization's network security and operational efficiency.</li>
<li data-line="3" dir="auto">Assigning intuitive interface names in the firewall greatly simplified the management and understanding of iptables rules. </li>
<li data-line="4" dir="auto">Prior experience with ACL on Cisco Packet Tracer was beneficial in grasping the structure and logic behind iptables rules.</li>
<li data-line="5" dir="auto">Creating packet flow diagrams and making assumptions on what effects a configuration change would do before testing proved highly effective in identifying overlooked aspects. </li>
</ul></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="V. Next Steps" dir="auto" class="heading" id="V._Next_Steps"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>V. Next Steps</h2><div class="heading-children"><div class="el-ul"><ul>
<li data-line="0" dir="auto">Configure Wazuh to receive and analyze iptables firewall logs.</li>
<li data-line="1" dir="auto">Fine-tune Wazuh rules to focus on more critical events and reduce noise.</li>
<li data-line="2" dir="auto">Implement File Integrity feature of Wazuh for the AD environment to detect unauthorized changes.</li>
<li data-line="3" dir="auto">Harden a Wazuh agent's host to further improve overall security.</li>
<li data-line="4" dir="auto">Enhance current iptables rules for stronger filtering and improved visibility.</li>
<li data-line="5" dir="auto">Continue documenting incremental improvements in the configurations and lab architecture.</li>
</ul></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="VI. Conclusion" dir="auto" class="heading" id="VI._Conclusion"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>VI. Conclusion</h2><div class="heading-children"><div class="el-p"><p dir="auto">This setup phase was essential in establishing the initial configurations of the home laboratory's core components. Deploying Wazuh server, Active Directory domain, and setting up iptables-based firewall provided practical insights into enterprise-grade security tools and their role in securing a network. </p></div></div></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="References" dir="auto" class="heading" id="References">References</h1><div class="heading-children"><div class="el-ul"><ul>
<li data-line="0" dir="auto"><a data-tooltip-position="top" aria-label="https://documentation.wazuh.com/current/deployment-options/docker/index.html" rel="noopener nofollow" class="external-link" href="https://documentation.wazuh.com/current/deployment-options/docker/index.html" target="_blank">Deployment on Docker - Wazuh documentation</a></li>
<li data-line="1" dir="auto"><a data-tooltip-position="top" aria-label="https://www.itechguides.com/how-to-setup-a-windows-server-2022-ad-domain-step-by-step/" rel="noopener nofollow" class="external-link" href="https://www.itechguides.com/how-to-setup-a-windows-server-2022-ad-domain-step-by-step/" target="_blank">How to Setup a Windows Server 2022 AD Domain (Step-by-step) - Itechguides</a></li>
<li data-line="2" dir="auto"><a data-tooltip-position="top" aria-label="https://www.youtube.com/watch?v=NAdJojxENEU" rel="noopener nofollow" class="external-link" href="https://www.youtube.com/watch?v=NAdJojxENEU" target="_blank">iptables Demystified - Port Redirection and Forwarding HTTP Traffic to another machine</a></li>
<li data-line="3" dir="auto"><a data-tooltip-position="top" aria-label="https://en.wikipedia.org/wiki/Netfilter" rel="noopener nofollow" class="external-link" href="https://en.wikipedia.org/wiki/Netfilter" target="_blank">Netfilter - Wikipedia</a></li>
<li data-line="4" dir="auto"><a data-tooltip-position="top" aria-label="https://tecadmin.net/enable-logging-in-iptables-on-linux/" rel="noopener nofollow" class="external-link" href="https://tecadmin.net/enable-logging-in-iptables-on-linux/" target="_blank">Enabling Logging in Iptables on Linux: A Beginner's Guide – TecAdmin</a></li>
<li data-line="5" dir="auto"><a data-tooltip-position="top" aria-label="https://www.networkinghowtos.com/howto/change-the-iptables-log-file/#:~:text=If%20you%20want%20to%20change%20the%20file%20that,log%20file%2C%20containing%20just%20the%20iptables%20log%20information." rel="noopener nofollow" class="external-link" href="https://www.networkinghowtos.com/howto/change-the-iptables-log-file/#:~:text=If%20you%20want%20to%20change%20the%20file%20that,log%20file%2C%20containing%20just%20the%20iptables%20log%20information." target="_blank">Change the IPTables log file - Networking HowTos</a></li>
</ul></div><div class="mod-footer mod-ui"></div></div></div></div></div></div><div class="sidebar-right sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="tree-container mod-root nav-folder tree-item outline-tree" data-depth="0"><div class="tree-header"><span class="sidebar-section-header">Table Of Contents</span><button class="clickable-icon collapse-tree-button is-collapsed" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-scroll-area tree-item-children nav-folder-children"><div class="tree-item mod-tree-folder nav-folder mod-collapsible is-collapsed" style="display: none;"></div><div class="tree-item" data-depth="1"><a class="tree-link" href="projects\initial-home-lab-setup.html#Initial Home Lab Setup"><div class="tree-item-contents heading-link" heading-name="Initial Home Lab Setup"><span class="tree-item-title">Initial Home Lab Setup</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item mod-collapsible is-collapsed" data-depth="2"><a class="tree-link" href="projects\initial-home-lab-setup.html#I._Introduction"><div class="tree-item-contents heading-link" heading-name="I. Introduction"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">I. Introduction</span></div></a><div class="tree-item-children nav-folder-children" style="display: none;"><div class="tree-item" data-depth="3"><a class="tree-link" href="projects\initial-home-lab-setup.html#1.1_Context_&amp;_Purpose"><div class="tree-item-contents heading-link" heading-name="1.1 Context &amp; Purpose"><span class="tree-item-title">1.1 Context &amp; Purpose</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="projects\initial-home-lab-setup.html#1.2_What_This_Covers"><div class="tree-item-contents heading-link" heading-name="1.2 What This Covers"><span class="tree-item-title">1.2 What This Covers</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item mod-collapsible is-collapsed" data-depth="2"><a class="tree-link" href="projects\initial-home-lab-setup.html#II._Setup_&amp;_Environment"><div class="tree-item-contents heading-link" heading-name="II. Setup &amp; Environment"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">II. Setup &amp; Environment</span></div></a><div class="tree-item-children nav-folder-children" style="display: none;"><div class="tree-item" data-depth="3"><a class="tree-link" href="projects\initial-home-lab-setup.html#2.1_Network_Overview"><div class="tree-item-contents heading-link" heading-name="2.1 Network Overview"><span class="tree-item-title">2.1 Network Overview</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="projects\initial-home-lab-setup.html#2.2_Prerequisites"><div class="tree-item-contents heading-link" heading-name="2.2 Prerequisites"><span class="tree-item-title">2.2 Prerequisites</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item mod-collapsible is-collapsed" data-depth="2"><a class="tree-link" href="projects\initial-home-lab-setup.html#III._Execution_&amp;_Findings"><div class="tree-item-contents heading-link" heading-name="III. Execution &amp; Findings"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">III. Execution &amp; Findings</span></div></a><div class="tree-item-children nav-folder-children" style="display: none;"><div class="tree-item mod-collapsible is-collapsed" data-depth="3"><a class="tree-link" href="projects\initial-home-lab-setup.html#3.1_Wazuh_on_Docker_(Ubuntu)"><div class="tree-item-contents heading-link" heading-name="3.1 Wazuh on Docker (Ubuntu)"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">3.1 Wazuh on Docker (Ubuntu)</span></div></a><div class="tree-item-children nav-folder-children" style="display: none;"><div class="tree-item" data-depth="5"><a class="tree-link" href="projects\initial-home-lab-setup.html#3.1.1_Wazuh_Server"><div class="tree-item-contents heading-link" heading-name="3.1.1 Wazuh Server"><span class="tree-item-title">3.1.1 Wazuh Server</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="projects\initial-home-lab-setup.html#3.1.2_Wazuh_Agent"><div class="tree-item-contents heading-link" heading-name="3.1.2 Wazuh Agent"><span class="tree-item-title">3.1.2 Wazuh Agent</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="projects\initial-home-lab-setup.html#3.2_Active_Directory_Domain_(Windows_Server_2022)"><div class="tree-item-contents heading-link" heading-name="3.2 Active Directory Domain (Windows Server 2022)"><span class="tree-item-title">3.2 Active Directory Domain (Windows Server 2022)</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item mod-collapsible is-collapsed" data-depth="3"><a class="tree-link" href="projects\initial-home-lab-setup.html#3.3_Iptables_Firewall_(AntiX)"><div class="tree-item-contents heading-link" heading-name="3.3 Iptables Firewall (AntiX)"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">3.3 Iptables Firewall (AntiX)</span></div></a><div class="tree-item-children nav-folder-children" style="display: none;"><div class="tree-item" data-depth="5"><a class="tree-link" href="projects\initial-home-lab-setup.html#3.3.1_Renaming_Network_Interfaces"><div class="tree-item-contents heading-link" heading-name="3.3.1 Renaming Network Interfaces"><span class="tree-item-title">3.3.1 Renaming Network Interfaces</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="projects\initial-home-lab-setup.html#3.3.2_Assigning_Static_Route_and_IP_Address"><div class="tree-item-contents heading-link" heading-name="3.3.2 Assigning Static Route and IP Address"><span class="tree-item-title">3.3.2 Assigning Static Route and IP Address</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="projects\initial-home-lab-setup.html#3.3.3_IP_Forwarding"><div class="tree-item-contents heading-link" heading-name="3.3.3 IP Forwarding"><span class="tree-item-title">3.3.3 IP Forwarding</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="projects\initial-home-lab-setup.html#3.3.4_Configuring_NAT_with_iptables"><div class="tree-item-contents heading-link" heading-name="3.3.4 Configuring NAT with iptables"><span class="tree-item-title">3.3.4 Configuring NAT with iptables</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="projects\initial-home-lab-setup.html#3.3.5_SSH_Port_Forwarding"><div class="tree-item-contents heading-link" heading-name="3.3.5 SSH Port Forwarding"><span class="tree-item-title">3.3.5 SSH Port Forwarding</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item mod-collapsible is-collapsed" data-depth="3"><a class="tree-link" href="projects\initial-home-lab-setup.html#3.4_Lab_Network_Configuration"><div class="tree-item-contents heading-link" heading-name="3.4 Lab Network Configuration"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">3.4 Lab Network Configuration</span></div></a><div class="tree-item-children nav-folder-children" style="display: none;"><div class="tree-item" data-depth="5"><a class="tree-link" href="projects\initial-home-lab-setup.html#3.4.1_Router_WAN_Configuration"><div class="tree-item-contents heading-link" heading-name="3.4.1 Router WAN Configuration"><span class="tree-item-title">3.4.1 Router WAN Configuration</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="projects\initial-home-lab-setup.html#3.4.2_Router_LAN_Configuration"><div class="tree-item-contents heading-link" heading-name="3.4.2 Router LAN Configuration"><span class="tree-item-title">3.4.2 Router LAN Configuration</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item mod-collapsible is-collapsed" data-depth="3"><a class="tree-link" href="projects\initial-home-lab-setup.html#3.5_Filtering_Traffic"><div class="tree-item-contents heading-link" heading-name="3.5 Filtering Traffic"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">3.5 Filtering Traffic</span></div></a><div class="tree-item-children nav-folder-children" style="display: none;"><div class="tree-item" data-depth="5"><a class="tree-link" href="projects\initial-home-lab-setup.html#3.5.1_Logging_and_Blocking_on_iptables"><div class="tree-item-contents heading-link" heading-name="3.5.1 Logging and Blocking on iptables"><span class="tree-item-title">3.5.1 Logging and Blocking on iptables</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="projects\initial-home-lab-setup.html#3.5.2_Dedicating_a_Log_File_for_Iptables"><div class="tree-item-contents heading-link" heading-name="3.5.2 Dedicating a Log File for Iptables"><span class="tree-item-title">3.5.2 Dedicating a Log File for Iptables</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="projects\initial-home-lab-setup.html#3.5.3_Testing_Firewall_Rules"><div class="tree-item-contents heading-link" heading-name="3.5.3 Testing Firewall Rules"><span class="tree-item-title">3.5.3 Testing Firewall Rules</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="projects\initial-home-lab-setup.html#IV._Observations"><div class="tree-item-contents heading-link" heading-name="IV. Observations"><span class="tree-item-title">IV. Observations</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="projects\initial-home-lab-setup.html#V._Next_Steps"><div class="tree-item-contents heading-link" heading-name="V. Next Steps"><span class="tree-item-title">V. Next Steps</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="projects\initial-home-lab-setup.html#VI._Conclusion"><div class="tree-item-contents heading-link" heading-name="VI. Conclusion"><span class="tree-item-title">VI. Conclusion</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="projects\initial-home-lab-setup.html#References"><div class="tree-item-contents heading-link" heading-name="References"><span class="tree-item-title">References</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div><script defer="">let rs = document.querySelector(".sidebar-right"); rs.classList.add("is-collapsed"); if (window.innerWidth > 768) rs.classList.remove("is-collapsed"); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></body></html>